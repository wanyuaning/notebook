<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <canvas id="myCanvas" width="1000" height="600"></canvas>

  <div>
    <button onclick="stage.clean()">clear</button>
  </div>
  
</body>
</html>
<script type="text/javascript">



  class Stage{
    #canvas
    #context
    #width
    #height
    constructor(canvas, width, height){
      this.#canvas = canvas
      this.#context = canvas.getContext("2d")
      this.#width = width
      this.#height = height
    }
    showRuler(){
      let w = this.#width, h = this.#height, ctx = this.#context
      ctx.strokeStyle = '#ccc'
      ctx.beginPath()
      for(let i = 10; i < w; i += 10){ ctx.moveTo(i+0.5, 0); ctx.lineTo(i+0.5, 4) }
      for(let i = 10; i < h; i += 10){ ctx.moveTo(0, i+0.5); ctx.lineTo(4, i+0.5) }
      for(let i = 100; i < w; i += 100){ ctx.moveTo(i+0.5, 0); ctx.lineTo(i+0.5, 8) }
      for(let i = 100; i < h; i += 100){ ctx.moveTo(0, i+0.5); ctx.lineTo(8, i+0.5) }
      ctx.moveTo(0, h)
      ctx.lineTo(0, 0)
      ctx.lineTo(w, 0)
      ctx.stroke()
      ctx.beginPath()
    }
    // config{cellSize: 10}
    showGrid(config){
      let w = this.#width, h = this.#height, size = 20, color = '#eee', lineWidth = '1px', ctx = this.#context
      if(config) {
        config.cellSize && (size = config.cellSize)
        config.strokeStyle && (color = config.strokeStyle)
        config.lineWidth && (lineWidth = config.lineWidth)
      }
      ctx.strokeStyle = color
      ctx.lineWidth = lineWidth
      ctx.beginPath()
      for(let i = 0; i < w; i += size){ ctx.moveTo(i+0.5, 0); ctx.lineTo(i+0.5, h) }
      for(let i = 0; i < h; i += size){ ctx.moveTo(0, i+0.5); ctx.lineTo(w, i+0.5) }
      ctx.moveTo(w, 0)
      ctx.lineTo(w, h)
      ctx.lineTo(0, h)
      ctx.stroke()
      ctx.beginPath()
    }
    clean(){ this.#context .clearRect(0, 0, this.#width, this.#height) }    
    drawRect(x, y, width, height, options, config){ 
      if (!options) { console.error('Stage: drawRect(x, y, width, height, options), Please configure options'); return }
      Object.assign(this.#context, options || {})
      this.#context.beginPath()
      options.fillStyle && this.#context.fillRect(x, y, width, height)
      options.strokeStyle && this.#context.strokeRect(x, y, width, height)
    }
    drawCircle(x, y, r, options, config){
      if (!options) { console.error('Stage: drawCircle(x, y, r, options), Please configure options'); return }
      Object.assign(this.#context, options || {})
      this.#context.beginPath()
      this.#context.arc(x, y, r, 0, 2*Math.PI, false);
      this.#context.closePath();
      options.fillStyle && this.#context.fill();
      options.strokeStyle && this.#context.stroke();
    }
    drawText(text, x, y, options, config){
      if (!options) { 
        console.error('Stage: drawText(text, x, y, options), Please configure options')
        console.info('For example: {fillStyle:"#999", strokeStyle:"#000", maxWidth:100, font:"20px Arial", textBaseline:"top", textAlign:"center"}')
        return 
      }
      if (options.font && options.font.indexOf(' ') < 0) options.font += ' Arial'
      Object.assign(this.#context, options)
      let maxWidth = options.maxWidth || this.#context.measureText(text).width
      this.#context.beginPath()
      options.fillStyle && this.#context.fillText(text, x, y, maxWidth)
      options.strokeStyle && this.#context.strokeText(text, x, y, maxWidth)
    }
    drawLine(start, end, options, config){
      if (!options) { 
        console.error('Stage: drawLine(start, end, options), Please configure options')
        console.info('For example: {strokeStyle:"#000", lineWidth:5, lineCap:"round"}')
        return 
      }
      Object.assign(this.#context, options)
      this.#context.beginPath();
      this.#context.lineTo(start[0], start[1]);
      this.#context.lineTo(end[0], end[1]);
      options.strokeStyle && this.#context.stroke();
    }

    /**
     * 多边形
     * [[0,0], [50,0]]
     * options{fillStyle:'#ccc', strokeStyle:'#000', lineWidth:5, lineCap:'round'}
     * config{closePath: true, startPosition: [0, 0]}
     */
    drawPolygon(pointsArr, options, config){
      let xPos = 0, yPos = 0, ctx = this.#context
      Object.assign(ctx, options || {})
      ctx.beginPath()
      if (config && config.startPosition) {xPos = config.startPosition[0], yPos = config.startPosition[1]} 
      for(let i = 0, len = pointsArr.length; i < len - 1; i++){
        let start=pointsArr[i], end=pointsArr[i+1]
        ctx.lineTo(start[0] + xPos, start[1] + yPos)
        ctx.lineTo(end[0] + xPos, end[1] + yPos)
			}
      if(options.fillStyle) {
        ctx.closePath()
        ctx.fill()
      }
      config && config.closePath && ctx.closePath()
      options.strokeStyle && ctx.stroke()
    }
    /**
     * 图片
     * img	          规定要使用的图像、画布或视频。
       sx	sy	        可选。开始剪切的 xy 坐标位置。
       swidth sheight	可选。被剪切图像的宽度高度。
       x y	          在画布上放置图像的 xy 坐标位置。
       width height	  可选。要使用的图像的宽度高度。（伸展或缩小图像）
     */
    drawImage(img, sx, sy, swidth, sheight, x, y, width, height){
      let context = this.#context;
      context.drawImage(img, sx, sy, swidth, sheight, x, y, width, height)
    }
    aa(){
      context.save();
      context.translate(this.x + halfWith, this.y + halfHeight);
      context.rotate(((this.angle * Math.PI) / 180) * -1);
      context.drawImage(this.image, this.imgX, this.imgY, this.imgWidth, this.imgHeight, -halfWith, -halfHeight, this.width, this.height);
      context.restore();
    }
  }

  let stage = new Stage(document.getElementById("myCanvas"), 1000, 600)
  //stage.showGrid({cellSize: 40})
  stage.showRuler()
  stage.drawRect(10, 10, 100, 50, {fillStyle: '#0f0'})
  stage.drawCircle(200, 35, 25, {fillStyle: '#f00', strokeStyle: '#000', lineWidth: 5})
  stage.drawText('123456789', 10, 70, {fillStyle: '#f00', font: '30px'})
  stage.drawLine([10,90], [200,100], {strokeStyle:'#00f', lineWidth:10, lineCap: 'round'})
  stage.drawLine([10,120], [200,130], {strokeStyle:'#0f0', lineWidth:5})
  stage.drawPolygon([[0,0], [50,0], [50,50], [100,50], [100,100], [50,100], [50,150], [0,150], [0,100], [-50,100], [-50,50], [0,50]], {strokeStyle:'#0f0', lineWidth:5}, {closePath: true, startPosition: [300, 100]})
  // stage.drawRectFill(10, 10, 50, 50, '#f00')
  // stage.drawRectStroke(80, 10, 50, 50, '#0f0')
  // stage.drawCircleFill(170, 35, 25, 0, Math.PI*2, false, '#0f0')
  // stage.drawCircleStroke(240, 35, 25, 0, Math.PI*2, false, '#0f0')
  // stage.drawTextFill("文本样本", "20px Georgia", null, 'left', 200, '#f00', 300, 40)
  // stage.drawTextStroke("文本样本", "20px Georgia", null, 'left', 200, '#f00', 400, 40)
  // stage.drawLine('#00f', 5, [500,35], [600,35])
  // stage.drawPolygonFill([[10,80], [100,80], [100, 180], [20, 180]], '#00f')
  // stage.drawPolygonStroke([[120,80], [200,80], [200, 180], [130, 180]], '#f00')
  // var img = new Image()
  // img.onload = function(){
  //   stage.drawImage(this, 0, 0, 202, 205, 10, 220, 80, 80)
  // }
  // img.src = '001.png'
  
  

</script>

  

  
  
  
  
