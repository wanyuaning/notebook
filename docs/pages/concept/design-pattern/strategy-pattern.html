<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div id="container" style="width:500px;margin:0 auto;background-color: silver;">
    <div id="move" style="position: absolute;background-color:blue;width:20px;height:20px"></div>
  </div>
  <script>
    class StrategyPattern{
      #strategy
      setStrategy(obj){this.#strategy = obj}
      addStrategy(name, fn){this.#strategy[name] = fn}
      useStrategy(name){return this.#strategy[name]}
    }
    class StatePattern{
      #state
      setState(obj){this.#state = obj}
      autoUse(name){return this.#state[name]}
    }

    var container = document.getElementById('container'); container.style.height = window.innerHeight +"px";
    var move = document.getElementById('move');

    let tweens = new StrategyPattern()
    tweens.setStrategy({
      linear: (t,b,c,d) => c*t/d+b,
      easeIn: (t,b,c,d) => c*(t/=d)*t+b,
      strongEaseIn: (t,b,c,d) => c*(t/=d)*t*t*t*t+b,
      strongEaseOut: (t,b,c,d) => c*((t=t/d-1)*t*t*t*t+1)+b,
      sineaseIn: (t,b,c,d) => c*(t/=d)*t*t+b,
      sineaseOut: (t,b,c,d) => c*((t=t/d-1)*t*t+1)+b
    })
    let domState = new StatePattern()
    domState.setState({
      bottom: (val) => {move.style.bottom = val +'px';}
    })

    

    class Animation{
      constructor(dom){
        this.dom = dom
        this.startTime = 0
        this.startPos = 0
        this.endPos = 0
        this.duration = 0        //小球运动的时间
        this.propertyName = null //要改变的css属性,例如top,left
        this.easing=null         //缓动算法
      }
      start(endPos,duration,propertyName,easing){
        //记录开始位置,并设置定时器是否有要执行的步数
        this.startTime = new Date();
        this.startPos = this.dom.getBoundingClientRect()[propertyName];
        this.endPos = endPos;
        this.duration = duration;
        this.propertyName = propertyName;
        this.easing = tweens.useStrategy(easing);
        var setTime = setInterval(function(){
            if(this.step()){
                clearsetInterval(setTime);
            }
            this.step();
        }.bind(this),20)
      }
      step(){//动画执行一步需要的操作
        var t = +new Date();
        if(t>this.startTime+this.duration){
            this.update(this.endPos);
            return false;
        }
        var pos = this.easing(t-this.startTime,this.startPos,this.endPos,this.duration);//t动画已消耗时间、b原始位置、c目标位置、d持续时间
        this.update(pos);
      }
      update(pos){//更新div的css属性
        if(pos > window.innerWidth || pos>window.innerHeight){
            //this.dom.style[this.propertyName] = this.endPos +'px';
            domState.autoUse(this.propertyName)(this.endPos)
            return false;
        }
        //this.dom.style[this.propertyName] = pos +'px';
        domState.autoUse(this.propertyName)(this.endPos)
      }
    }
    
    
    
    
    //调用
    
    var a = new Animation(move);
    a.start(100,1000,'bottom','easeIn')
  </script>
</body>
</html>